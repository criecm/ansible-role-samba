---
- debug:
    var: share

- name: test share.path
  stat:
    path: '{{ share.path }}'
  register: path_stat

# create
- block:
  # need mkdir
  - name: zfs create
    zfs:
      name: '{{ share.zfsrc }}'
      state: present
      mountpoint: '{{ share.path }}'
      aclmode: passthrough
      aclinherit: passthrough
    when: '"zfsrc" in share'
  - name: mkdir
    file:
      path: '{{ share.path }}'
      state: directory
    when: '"zfsrc" not in share'
  when: not path_stat.stat.exists

